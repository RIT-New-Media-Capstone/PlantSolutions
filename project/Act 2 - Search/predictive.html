<script>
  const searchInput = document.getElementById('search');
  const suggestionsList = document.getElementById('suggestions');

  async function fetchOpenAISuggestions(query) {
    try {
      const response = await fetch('http://localhost:3000/api/suggestions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ query })
      });

      const data = await response.json();
      return data.suggestions;
    } catch (error) {
      console.error('Error fetching suggestions:', error);
      return [];
    }
  }

  async function fetchPlantDetails(plantName) {
    try {
      const response = await fetch('http://localhost:3000/api/plantDetails', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ plantName })
      });

      const data = await response.json();
      return data.details; // Detailed plant info
    } catch (error) {
      console.error('Error fetching plant details:', error);
    }
  }

  // Display suggestions as the user types
  searchInput.addEventListener('input', async function() {
    const input = searchInput.value.trim();

    if (input.length > 0) {
      const suggestions = await fetchOpenAISuggestions(input);
      suggestionsList.innerHTML = '';

      if (suggestions.length) {
        suggestionsList.style.display = 'block'; // Show suggestions
        suggestions.forEach(item => {
          const listItem = document.createElement('li');
          listItem.textContent = item;
          suggestionsList.appendChild(listItem);

          // Mark this function as async
          listItem.addEventListener('click', async () => {
            searchInput.value = item; // Set input to selected item
            suggestionsList.innerHTML = ''; // Clear suggestions
            suggestionsList.style.display = 'none'; // Hide the list

            // Fetch details for the selected plant and redirect
            const plantDetails = await fetchPlantDetails(item);
            generateProfilePage(plantDetails);
          });
        });
      } else {
        suggestionsList.style.display = 'none'; // Hide suggestions if none are returned
      }
    } else {
      suggestionsList.style.display = 'none'; // Hide suggestions if input is empty
    }
  });

  function generateProfilePage(plantDetails) {
    // You can use localStorage to pass the plant details to a new page
    localStorage.setItem('plantDetails', JSON.stringify(plantDetails));
    
    // Redirect to the profile page
    window.location.href = 'plantProfile.html';
  }
</script>
